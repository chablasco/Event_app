<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@500&family=Roboto+Mono:wght@400&family=Poppins:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: light dark;
            --surface: #f6f8fa;
            --surface-strong: #ffffff;
            --surface-muted: #e9eef3;
            --border: #d0d7de;
            --text: #111827;
            --accent: #2563eb;
            --accent-strong: #1d4ed8;
            --success: #0f9d58;
            --danger: #dc2626;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: radial-gradient(circle at top left, #eff6ff, #f8fafc 45%, #e0f2fe);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 1.8rem clamp(1rem, 4vw, 3rem);
            background: rgba(15, 23, 42, 0.75);
            color: white;
            backdrop-filter: blur(8px);
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12);
        }

        header h1 {
            margin: 0;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-size: clamp(1.4rem, 2.8vw, 2rem);
        }

        header p {
            margin: 0.35rem 0 0;
            opacity: 0.85;
            max-width: 48rem;
            line-height: 1.5;
        }

        main {
            flex: 1;
            width: min(1200px, 95vw);
            margin: 2.5rem auto 3rem;
            display: grid;
            gap: 2.5rem;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }

        section {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            padding: clamp(1.5rem, 3vw, 2.5rem);
            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.12);
            backdrop-filter: blur(10px);
        }

        h2 {
            font-size: 1.4rem;
            margin: 0 0 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        h2 span {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 0.75rem;
            background: linear-gradient(135deg, var(--accent), var(--accent-strong));
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .field-group {
            display: grid;
            gap: 1.5rem;
        }

        label {
            font-weight: 600;
            display: block;
            margin-bottom: 0.4rem;
        }

        input[type="text"],
        input[type="datetime-local"],
        input[type="email"],
        input[type="url"],
        textarea,
        select {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            font: inherit;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.06);
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
            outline: none;
        }

        .time-grid {
            display: grid;
            gap: 1.2rem;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        .style-grid {
            display: grid;
            gap: 1.2rem;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            align-items: end;
        }

        .style-grid label {
            margin-bottom: 0.6rem;
        }

        input[type="color"] {
            height: 48px;
            padding: 0;
            border-radius: 12px;
            border: none;
            box-shadow: inset 0 0 0 1px var(--border);
            cursor: pointer;
        }

        input[type="file"] {
            font: inherit;
        }

        button {
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.2rem;
            font: inherit;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        button.primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-strong));
            color: white;
            box-shadow: 0 14px 24px rgba(37, 99, 235, 0.35);
        }

        button.secondary {
            background: rgba(37, 99, 235, 0.08);
            color: var(--accent-strong);
        }

        button.danger {
            background: rgba(220, 38, 38, 0.1);
            color: var(--danger);
        }

        button:hover {
            transform: translateY(-1px);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 1.6rem;
        }

        .message {
            margin-top: 1rem;
            padding: 0.85rem 1rem;
            border-radius: 12px;
            font-size: 0.95rem;
            display: none;
        }

        .message.visible {
            display: block;
        }

        .message.error {
            background: rgba(220, 38, 38, 0.1);
            color: var(--danger);
        }

        .message.success {
            background: rgba(15, 157, 88, 0.15);
            color: var(--success);
        }

        .invite-tools {
            margin-top: 2.5rem;
            border-top: 1px solid var(--surface-muted);
            padding-top: 2.5rem;
            display: grid;
            gap: 1.5rem;
        }

        .invite-tools textarea {
            min-height: 90px;
        }

        .share-row {
            display: flex;
            gap: 0.75rem;
        }

        .share-row input {
            flex: 1;
            font-weight: 500;
        }

        .helper {
            margin: 0.35rem 0 0;
            font-size: 0.85rem;
            color: rgba(15, 23, 42, 0.68);
        }

        .preview-card {
            position: relative;
            border-radius: 24px;
            overflow: hidden;
            display: grid;
            gap: 0;
            min-height: 100%;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.06);
            background: #ffffff;
        }

        .cover {
            min-height: 200px;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(14, 116, 144, 0.85)), url('https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=1200&q=80') center/cover;
            display: flex;
            align-items: flex-end;
            padding: 2rem;
            color: white;
        }

        .cover h3 {
            margin: 0;
            font-size: clamp(1.8rem, 3vw, 2.4rem);
            text-shadow: 0 10px 25px rgba(15, 23, 42, 0.3);
        }

        .event-content {
            padding: clamp(1.8rem, 3vw, 2.3rem);
            display: grid;
            gap: 1.4rem;
            background: inherit;
        }

        .event-meta {
            display: grid;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .event-meta span {
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
        }

        .event-description {
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .rsvp-section {
            margin-top: 2rem;
            background: rgba(15, 23, 42, 0.04);
            border-radius: 18px;
            padding: 1.8rem;
            display: grid;
            gap: 1.3rem;
        }

        .rsvp-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .rsvp-actions button {
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }

        .rsvp-list {
            display: grid;
            gap: 1.5rem;
        }

        .rsvp-group {
            background: white;
            border-radius: 16px;
            padding: 1.2rem 1.4rem;
            border: 1px solid var(--surface-muted);
            display: grid;
            gap: 0.8rem;
        }

        .rsvp-group header {
            position: static;
            background: none;
            color: inherit;
            box-shadow: none;
            padding: 0;
        }

        .rsvp-group h4 {
            margin: 0;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rsvp-group ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            gap: 0.45rem;
        }

        .rsvp-group li {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            font-size: 0.95rem;
        }

        .rsvp-group li span {
            opacity: 0.7;
            font-size: 0.85rem;
        }

        .empty-state {
            padding: 1rem;
            background: rgba(37, 99, 235, 0.08);
            border-radius: 12px;
            text-align: center;
            color: rgba(15, 23, 42, 0.6);
        }

        @media (max-width: 900px) {
            header {
                position: static;
            }
        }

        @media (max-width: 720px) {
            .share-row {
                flex-direction: column;
            }

            .share-row button {
                width: 100%;
                justify-content: center;
            }

            .rsvp-actions button {
                flex: 1 1 45%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Event Studio</h1>
        <p>Skapa, anpassa och dela dina event på några minuter. Välj färger och typsnitt, lägg till en omslagsbild och bjud enkelt in dina gäster.</p>
    </header>
    <main>
        <section aria-labelledby="form-title">
            <h2 id="form-title"><span>1</span> Bygg ditt event</h2>
            <form id="eventForm">
                <div class="field-group">
                    <div>
                        <label for="eventName">Eventnamn</label>
                        <input type="text" id="eventName" name="eventName" placeholder="Spelkväll med vänner" required>
                    </div>
                    <div class="time-grid">
                        <div>
                            <label for="startTime">Starttid</label>
                            <input type="datetime-local" id="startTime" name="startTime" required>
                        </div>
                        <div>
                            <label for="endTime">Sluttid</label>
                            <input type="datetime-local" id="endTime" name="endTime" required>
                        </div>
                    </div>
                    <div>
                        <label for="description">Beskrivning</label>
                        <textarea id="description" name="description" placeholder="Beskriv vad som händer, vad gästerna ska ta med och annan viktig information." required></textarea>
                    </div>
                    <div class="style-grid">
                        <div>
                            <label for="backgroundColor">Bakgrundsfärg</label>
                            <input type="color" id="backgroundColor" name="backgroundColor" value="#f8fafc">
                        </div>
                        <div>
                            <label for="textColor">Textfärg</label>
                            <input type="color" id="textColor" name="textColor" value="#0f172a">
                        </div>
                        <div>
                            <label for="fontFamily">Typsnitt</label>
                            <select id="fontFamily" name="fontFamily">
                                <option value="'Inter', sans-serif">Inter (modern)</option>
                                <option value="'Poppins', sans-serif">Poppins (rund)</option>
                                <option value="'Playfair Display', serif">Playfair Display (elegant)</option>
                                <option value="'Roboto Mono', monospace">Roboto Mono (teknisk)</option>
                                <option value="'Georgia', serif">Georgia (klassisk)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="coverImage">Omslagsbild</label>
                        <input type="file" id="coverImage" name="coverImage" accept="image/*">
                        <p class="helper">Ladda upp en bild (JPG eller PNG) för att sätta stämningen.</p>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary" aria-label="Uppdatera eventet">Uppdatera event</button>
                </div>
                <div class="message" id="formMessage" role="alert"></div>
            </form>

            <div class="invite-tools" aria-labelledby="invite-title">
                <h2 id="invite-title"><span>2</span> Bjud in gäster</h2>
                <div>
                    <label for="inviteEmails">Mejladresser</label>
                    <textarea id="inviteEmails" placeholder="Skriv eller klistra in adresser separerade med kommatecken eller radbrytningar."></textarea>
                    <p class="helper">Vi öppnar ditt e-postprogram så att du kan skicka en färdig inbjudan.</p>
                </div>
                <button type="button" class="primary" id="sendInvites">Skicka mejlinbjudan</button>
                <div class="message" id="inviteMessage" role="status"></div>
                <div>
                    <label for="shareLink">Delningslänk</label>
                    <div class="share-row">
                        <input type="text" id="shareLink" readonly aria-describedby="share-help" value="">
                        <button type="button" class="secondary" id="copyShare">Kopiera länk</button>
                    </div>
                    <p class="helper" id="share-help">Länken leder direkt till ditt event så att gäster kan tacka ja, nej eller kanske.</p>
                    <div class="message" id="shareMessage" role="status"></div>
                </div>
            </div>
        </section>

        <section aria-labelledby="preview-title">
            <h2 id="preview-title"><span>3</span> Förhandsgranska &amp; svara</h2>
            <article class="preview-card" id="eventPreview">
                <div class="cover" id="coverPreview">
                    <h3 id="previewTitle">Spelkväll med vänner</h3>
                </div>
                <div class="event-content" id="eventContent">
                    <div class="event-meta" id="eventMeta">
                        <span id="previewTime">Fredag 19 maj 2024 kl. 18:00 – 22:00</span>
                    </div>
                    <div class="event-description" id="previewDescription">Planera för en kväll med brädspel, snacks och skratt. Ta gärna med ett favoritspel!</div>
                    <section class="rsvp-section" aria-labelledby="rsvp-title">
                        <h3 id="rsvp-title">OSA direkt här</h3>
                        <p>Fyll i ditt namn (och mejl om du vill få bekräftelse) och välj sedan om du kommer, kanske eller inte kan delta.</p>
                        <div class="field-group">
                            <div>
                                <label for="rsvpName">Namn</label>
                                <input type="text" id="rsvpName" placeholder="Ditt namn">
                            </div>
                            <div>
                                <label for="rsvpEmail">Mejl (valfritt)</label>
                                <input type="email" id="rsvpEmail" placeholder="namn@example.se">
                            </div>
                        </div>
                        <div class="rsvp-actions">
                            <button type="button" class="primary" data-status="yes">Jag kommer</button>
                            <button type="button" class="secondary" data-status="maybe">Kanske</button>
                            <button type="button" class="danger" data-status="no">Kan tyvärr inte</button>
                        </div>
                        <div class="message" id="rsvpMessage" role="status" aria-live="polite"></div>
                        <div class="rsvp-list" id="rsvpList">
                            <div class="empty-state">Inga svar ännu. Dela länken eller skicka en inbjudan för att börja samla svar.</div>
                        </div>
                    </section>
                </div>
            </article>
        </section>
    </main>

    <template id="rsvpGroupTemplate">
        <div class="rsvp-group">
            <h4></h4>
            <ul></ul>
        </div>
    </template>

    <script>
        const eventForm = document.getElementById('eventForm');
        const eventNameInput = document.getElementById('eventName');
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');
        const descriptionInput = document.getElementById('description');
        const backgroundColorInput = document.getElementById('backgroundColor');
        const textColorInput = document.getElementById('textColor');
        const fontFamilySelect = document.getElementById('fontFamily');
        const coverImageInput = document.getElementById('coverImage');
        const formMessage = document.getElementById('formMessage');

        const coverPreview = document.getElementById('coverPreview');
        const previewTitle = document.getElementById('previewTitle');
        const previewTime = document.getElementById('previewTime');
        const previewDescription = document.getElementById('previewDescription');
        const eventContent = document.getElementById('eventContent');
        const shareLinkInput = document.getElementById('shareLink');
        const shareMessage = document.getElementById('shareMessage');

        const inviteEmailsInput = document.getElementById('inviteEmails');
        const sendInvitesButton = document.getElementById('sendInvites');
        const inviteMessage = document.getElementById('inviteMessage');

        const rsvpNameInput = document.getElementById('rsvpName');
        const rsvpEmailInput = document.getElementById('rsvpEmail');
        const rsvpMessage = document.getElementById('rsvpMessage');
        const rsvpList = document.getElementById('rsvpList');

        const rsvpButtons = document.querySelectorAll('.rsvp-actions button');
        const rsvpSection = document.querySelector('.rsvp-section');
        const rsvpGroupTemplate = document.getElementById('rsvpGroupTemplate');

        const rsvpRegistry = new Map();
        let currentCoverImage = null;

        const statusLabels = {
            yes: 'Kommer',
            maybe: 'Kanske',
            no: 'Kan inte'
        };

        const formatter = new Intl.DateTimeFormat('sv-SE', {
            dateStyle: 'full',
            timeStyle: 'short'
        });
        const timeFormatter = new Intl.DateTimeFormat('sv-SE', { timeStyle: 'short' });

        function formatSingleDateTime(value) {
            if (!value) {
                return '';
            }
            const date = new Date(value);
            if (Number.isNaN(date.getTime())) {
                return '';
            }
            return formatter.format(date);
        }

        function withAlpha(hex, alpha) {
            if (typeof hex !== 'string' || !hex.startsWith('#')) {
                return hex;
            }
            let normalized = hex.slice(1);
            if (normalized.length === 3) {
                normalized = normalized.split('').map(char => char + char).join('');
            }
            if (normalized.length !== 6) {
                return hex;
            }
            const r = parseInt(normalized.slice(0, 2), 16);
            const g = parseInt(normalized.slice(2, 4), 16);
            const b = parseInt(normalized.slice(4, 6), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function formatTimeRange(start, end) {
            try {
                const startDate = start ? new Date(start) : null;
                const endDate = end ? new Date(end) : null;

                if (!startDate || Number.isNaN(startDate.getTime())) {
                    return 'Ange starttid';
                }

                if (!endDate || Number.isNaN(endDate.getTime())) {
                    return formatter.format(startDate);
                }

                const sameDay = startDate.toDateString() === endDate.toDateString();
                if (sameDay) {
                    return `${formatter.format(startDate)} – ${timeFormatter.format(endDate)}`;
                }

                return `${formatter.format(startDate)} – ${formatter.format(endDate)}`;
            } catch (error) {
                return 'Tid ej tillgänglig';
            }
        }

        function showFormMessage(type, text) {
            formMessage.textContent = text;
            formMessage.className = `message ${type} visible`;
        }

        function updateShareLink() {
            const params = new URLSearchParams();
            if (eventNameInput.value) {
                params.set('name', eventNameInput.value);
            }
            if (startTimeInput.value) {
                params.set('start', startTimeInput.value);
            }
            if (endTimeInput.value) {
                params.set('end', endTimeInput.value);
            }
            if (descriptionInput.value) {
                params.set('description', descriptionInput.value);
            }
            const query = params.toString();
            const base = `${window.location.origin}${window.location.pathname}`;
            const url = query ? `${base}?${query}` : base;
            shareLinkInput.value = url;
        }

        function updatePreview() {
            const rawName = eventNameInput.value.trim();
            const name = rawName || 'Ditt event';
            previewTitle.textContent = name;
            previewTitle.style.fontFamily = fontFamilySelect.value;
            coverPreview.style.fontFamily = fontFamilySelect.value;

            eventContent.style.backgroundColor = backgroundColorInput.value;
            eventContent.style.color = textColorInput.value;
            eventContent.style.fontFamily = fontFamilySelect.value;
            rsvpSection.style.backgroundColor = withAlpha(backgroundColorInput.value, 0.25);
            rsvpSection.style.color = textColorInput.value;

            const timeText = formatTimeRange(startTimeInput.value, endTimeInput.value);
            previewTime.textContent = timeText;

            const description = descriptionInput.value.trim() || 'Berätta vad som händer under ditt event.';
            previewDescription.textContent = description;

            if (currentCoverImage) {
                coverPreview.style.backgroundImage = `linear-gradient(135deg, rgba(15, 23, 42, 0.55), rgba(15, 23, 42, 0.15)), url('${currentCoverImage}')`;
            } else {
                coverPreview.style.removeProperty('background-image');
                coverPreview.style.removeProperty('background-color');
            }

            applyRSVPStyling();
            document.title = rawName ? `${name} | Event Studio` : 'Event Studio';
            updateShareLink();
        }

        function handleCoverImage(file) {
            if (!file) {
                currentCoverImage = null;
                coverPreview.style.removeProperty('background-image');
                coverPreview.style.removeProperty('background-color');
                return;
            }

            const reader = new FileReader();
            reader.onload = event => {
                currentCoverImage = event.target.result;
                coverPreview.style.backgroundImage = `linear-gradient(135deg, rgba(15, 23, 42, 0.55), rgba(15, 23, 42, 0.15)), url('${currentCoverImage}')`;
            };
            reader.readAsDataURL(file);
        }

        eventForm.addEventListener('submit', event => {
            event.preventDefault();
            if (!eventForm.reportValidity()) {
                return;
            }

            const start = startTimeInput.value;
            const end = endTimeInput.value;
            if (start && end && new Date(end) < new Date(start)) {
                showFormMessage('error', 'Sluttiden måste vara efter starttiden.');
                return;
            }

            showFormMessage('success', 'Eventet uppdaterades. Dela det med dina gäster!');
            updatePreview();
        });

        coverImageInput.addEventListener('change', event => {
            const [file] = event.target.files;
            if (file) {
                if (!file.type.startsWith('image/')) {
                    showFormMessage('error', 'Välj en bildfil (JPG eller PNG).');
                    event.target.value = '';
                    return;
                }
                handleCoverImage(file);
            } else {
                handleCoverImage(null);
            }
        });

        [eventNameInput, startTimeInput, endTimeInput, descriptionInput, backgroundColorInput, textColorInput, fontFamilySelect].forEach(element => {
            element.addEventListener('input', () => {
                if (formMessage.classList.contains('success')) {
                    formMessage.classList.remove('visible');
                }
                updatePreview();
            });
        });

        function parseInvitees(input) {
            return input
                .split(/[\n,;]+/)
                .map(email => email.trim())
                .filter(Boolean);
        }

        function buildEmailBody(url) {
            const lines = [
                `Hej!`,
                '',
                `Du är inbjuden till ${eventNameInput.value || 'mitt event'}.`,
                `Start: ${formatSingleDateTime(startTimeInput.value) || 'Ange tid'}`,
                `Slut: ${formatSingleDateTime(endTimeInput.value) || 'Ange tid'}`,
                '',
                descriptionInput.value || '',
                '',
                `OSA och hitta mer information här: ${url}`,
                '',
                'Ser fram emot att ses!'
            ];
            return lines.join('\n');
        }

        sendInvitesButton.addEventListener('click', () => {
            const invitees = parseInvitees(inviteEmailsInput.value);
            if (!invitees.length) {
                inviteMessage.textContent = 'Lägg till minst en mejladress för att kunna skicka en inbjudan.';
                inviteMessage.className = 'message error visible';
                return;
            }

            const recipients = invitees.join(',');
            const params = new URLSearchParams({
                subject: `Inbjudan: ${eventNameInput.value || 'Event'}`,
                body: buildEmailBody(shareLinkInput.value || window.location.href)
            });
            window.location.href = `mailto:${recipients}?${params.toString()}`;

            inviteMessage.textContent = 'Vi har öppnat ditt e-postprogram med en färdig inbjudan.';
            inviteMessage.className = 'message success visible';
        });

        inviteEmailsInput.addEventListener('input', () => {
            inviteMessage.textContent = '';
            inviteMessage.className = 'message';
        });

        document.getElementById('copyShare').addEventListener('click', async () => {
            updateShareLink();
            try {
                await navigator.clipboard.writeText(shareLinkInput.value);
                shareMessage.textContent = 'Delningslänken kopierades till urklipp.';
                shareMessage.className = 'message success visible';
            } catch (error) {
                shareLinkInput.removeAttribute('readonly');
                shareLinkInput.select();
                shareLinkInput.setSelectionRange(0, shareLinkInput.value.length);
                shareLinkInput.setAttribute('readonly', 'readonly');
                shareLinkInput.blur();
                shareMessage.textContent = 'Kunde inte kopiera automatiskt. Kopiera gärna manuellt.';
                shareMessage.className = 'message error visible';
            }
        });

        function applyRSVPStyling() {
            const textColor = textColorInput.value || '#0f172a';
            const groupBackground = withAlpha(textColor, 0.08);
            const groupBorder = withAlpha(textColor, 0.2);
            rsvpSection.querySelectorAll('.rsvp-group').forEach(group => {
                group.style.backgroundColor = groupBackground;
                group.style.borderColor = groupBorder;
                group.style.color = textColor;
            });
            const emptyState = rsvpSection.querySelector('.empty-state');
            if (emptyState) {
                emptyState.style.color = textColor;
                emptyState.style.backgroundColor = withAlpha(textColor, 0.12);
            }
        }

        function updateRSVPList() {
            rsvpList.innerHTML = '';
            if (!rsvpRegistry.size) {
                const empty = document.createElement('div');
                empty.className = 'empty-state';
                empty.textContent = 'Inga svar ännu. Dela länken eller skicka en inbjudan för att börja samla svar.';
                rsvpList.appendChild(empty);
                applyRSVPStyling();
                return;
            }

            ['yes', 'maybe', 'no'].forEach(status => {
                const entries = Array.from(rsvpRegistry.values()).filter(entry => entry.status === status);
                if (!entries.length) {
                    return;
                }
                const group = rsvpGroupTemplate.content.firstElementChild.cloneNode(true);
                const header = group.querySelector('h4');
                const list = group.querySelector('ul');
                header.textContent = `${statusLabels[status]} (${entries.length})`;
                entries.forEach(entry => {
                    const item = document.createElement('li');
                    const name = document.createElement('span');
                    name.textContent = entry.name;
                    item.appendChild(name);
                    if (entry.email) {
                        const email = document.createElement('span');
                        email.textContent = entry.email;
                        item.appendChild(email);
                    }
                    list.appendChild(item);
                });
                rsvpList.appendChild(group);
            });
            applyRSVPStyling();
        }

        function handleRSVP(status) {
            const name = rsvpNameInput.value.trim();
            const email = rsvpEmailInput.value.trim();

            if (!name) {
                rsvpMessage.textContent = 'Skriv in ditt namn för att lämna ett svar.';
                rsvpMessage.className = 'message error visible';
                return;
            }

            const key = (email || name).toLowerCase();
            rsvpRegistry.set(key, { name, email, status });
            updateRSVPList();

            rsvpMessage.textContent = `Tack ${name}! Vi har sparat ditt svar: ${statusLabels[status].toLowerCase()}.`;
            rsvpMessage.className = 'message success visible';

            rsvpNameInput.value = '';
            rsvpEmailInput.value = '';
        }

        rsvpButtons.forEach(button => {
            button.addEventListener('click', () => {
                handleRSVP(button.dataset.status);
            });
        });

        function hydrateFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.size) {
                updateShareLink();
                return;
            }

            if (params.get('name')) {
                eventNameInput.value = params.get('name');
            }
            if (params.get('start')) {
                startTimeInput.value = params.get('start');
            }
            if (params.get('end')) {
                endTimeInput.value = params.get('end');
            }
            if (params.get('description')) {
                descriptionInput.value = params.get('description');
            }

            updatePreview();
        }

        hydrateFromURL();
    </script>
</body>
</html>
